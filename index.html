<!doctype html>
<html lang="it">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSIRT Management Platform</title>
    <link rel="stylesheet" href="src/styles.css">
    <style>@view-transition { navigation: auto; }</style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
    <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="login-screen" class="login-container">
      <div class="login-header">
        <h1>üõ°Ô∏è CSIRT Platform</h1>
        <p>Accedi al sistema</p>
      </div>
      <div id="login-message" class="message"></div>
      <form id="login-form">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input
            type="email"
            id="login-email"
            required
            inputmode="email"
            pattern="^[\w.+-]+@[\w.-]+\.[A-Za-z]{2,}$"
            placeholder="tua.email@example.com"
            aria-describedby="login-email-error"
            data-error-message="Inserisci un indirizzo email valido (es. nome@dominio.it)."
          >
          <p class="field-error" id="login-email-error" aria-live="polite"></p>
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input
            type="password"
            id="login-password"
            required
            placeholder="La tua password"
            aria-describedby="login-password-error"
          >
          <p class="field-error" id="login-password-error" aria-live="polite"></p>
        </div>
        <button type="submit" class="submit-btn">üîê Accedi</button>
      </form>
      <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e9ecef;">
        <p style="text-align: center; color: #666; margin-bottom: 15px;">
          <strong>Utenti Demo (Da Creare in Supabase Auth e Profiles):</strong>
        </p>
        <div style="font-size: 13px; color: #666; line-height: 1.8;">
          <p><strong>üëë Admin:</strong> admin@csirt.it / password123</p>
          <p><strong>üõ°Ô∏è Referente CSIRT:</strong> csirt@csirt.it / password123</p>
          <p><strong>üè¢ Referente Aziendale:</strong> company@example.com / password123</p>
          <p style="margin-top: 10px; font-size: 12px;">
            Crea gli utenti in <em>Supabase ‚Üí Authentication ‚Üí Users</em> e aggiungili nella tabella
            <code>profiles</code> come descritto in <code>SUPABASE_SETUP.md</code>.
          </p>
        </div>
      </div>
    </div>

    <div id="app-screen" class="app-container">
      <div class="container">
        <header>
          <div class="header-left">
            <h1>üõ°Ô∏è CSIRT Management Platform</h1>
            <p>Sistema di Gestione Computer Security Incident Response Team</p>
          </div>
          <div class="header-right">
            <div class="user-info">
              <div class="user-role" id="current-user-role">Ruolo</div>
              <div class="user-name" id="current-user-name">Nome Utente</div>
            </div>
            <button class="logout-btn" id="logout-btn">üö™ Esci</button>
          </div>
        </header>

        <nav id="main-nav">
          <button class="nav-btn active" data-target="designazione" data-permission="admin,csirt" aria-controls="designazione">üìã Designazione Referente</button>
          <button class="nav-btn" data-target="configurazione" data-permission="admin,csirt,company" aria-controls="configurazione">üåê Configurazione Rete</button>
          <button class="nav-btn" data-target="incidenti" data-permission="admin,csirt,company" aria-controls="incidenti">üö® Incidenti</button>
          <button class="nav-btn" data-target="visualizza" data-permission="admin,csirt,company" aria-controls="visualizza">üìä Visualizza Dati</button>
          <button class="nav-btn" data-target="notifiche" data-permission="admin,csirt,company" aria-controls="notifiche">üîî Notifiche</button>
          <button class="nav-btn" data-target="utenti" data-permission="admin" aria-controls="utenti">üë• Gestione Utenti</button>
        </nav>

        <div class="content">
          <section id="designazione" class="section active">
            <h2 class="section-title">Designazione Referente CSIRT</h2>
            <div id="designazione-message" class="message"></div>
            <form id="designazione-form">
              <h3 class="subsection-title">Dati Azienda</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="company_name">Ragione Sociale *</label>
                  <input type="text" id="company_name" required aria-describedby="company_name-error">
                  <p class="field-error" id="company_name-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="company_vat">Partita IVA *</label>
                  <input
                    type="text"
                    id="company_vat"
                    required
                    inputmode="numeric"
                    pattern="^[0-9]{11}$"
                    aria-describedby="company_vat-error"
                    data-error-message="La Partita IVA deve contenere 11 cifre numeriche."
                  >
                  <p class="field-error" id="company_vat-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="company_fiscal_code">Codice Fiscale</label>
                  <input
                    type="text"
                    id="company_fiscal_code"
                    inputmode="text"
                    pattern="^$|^[A-Za-z]{6}[0-9]{2}[A-Za-z][0-9]{2}[A-Za-z][0-9]{3}[A-Za-z]$"
                    aria-describedby="company_fiscal_code-error"
                    data-error-message="Inserisci un Codice Fiscale valido di 16 caratteri alfanumerici."
                  >
                  <p class="field-error" id="company_fiscal_code-error" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="company_sector">Settore *</label>
                  <select id="company_sector" required aria-describedby="company_sector-error">
                    <option value="">Seleziona...</option>
                    <option value="Energia">Energia</option>
                    <option value="Trasporti">Trasporti</option>
                    <option value="Bancario">Bancario</option>
                    <option value="Sanit√†">Sanit√†</option>
                    <option value="Telecomunicazioni">Telecomunicazioni</option>
                    <option value="Industria">Industria</option>
                    <option value="Pubblica Amministrazione">Pubblica Amministrazione</option>
                    <option value="Altro">Altro</option>
                  </select>
                  <p class="field-error" id="company_sector-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="company_address">Indirizzo *</label>
                  <input type="text" id="company_address" required aria-describedby="company_address-error">
                  <p class="field-error" id="company_address-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="data_nomina">Data Designazione *</label>
                  <input type="date" id="data_nomina" required aria-describedby="data_nomina-error">
                  <p class="field-error" id="data_nomina-error" aria-live="polite"></p>
                </div>
              </div>

              <h3 class="subsection-title">Referente Principale</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="main_role">Ruolo *</label>
                  <select id="main_role" required aria-describedby="main_role-error">
                    <option value="">Seleziona ruolo...</option>
                    <option value="Responsabile IT">Responsabile IT</option>
                    <option value="Responsabile Sicurezza">Responsabile Sicurezza</option>
                    <option value="Direttore Tecnico">Direttore Tecnico</option>
                  </select>
                  <p class="field-error" id="main_role-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="main_name">Nome *</label>
                  <input type="text" id="main_name" required aria-describedby="main_name-error">
                  <p class="field-error" id="main_name-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="main_surname">Cognome *</label>
                  <input type="text" id="main_surname" required aria-describedby="main_surname-error">
                  <p class="field-error" id="main_surname-error" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="main_fiscal_code">Codice Fiscale *</label>
                  <input
                    type="text"
                    id="main_fiscal_code"
                    required
                    pattern="^[A-Za-z]{6}[0-9]{2}[A-Za-z][0-9]{2}[A-Za-z][0-9]{3}[A-Za-z]$"
                    aria-describedby="main_fiscal_code-error"
                    data-error-message="Inserisci un Codice Fiscale valido di 16 caratteri alfanumerici."
                  >
                  <p class="field-error" id="main_fiscal_code-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="main_email">Email *</label>
                  <input
                    type="email"
                    id="main_email"
                    required
                    inputmode="email"
                    pattern="^[\w.+-]+@[\w.-]+\.[A-Za-z]{2,}$"
                    aria-describedby="main_email-error"
                    data-error-message="Inserisci un indirizzo email valido (es. nome@dominio.it)."
                  >
                  <p class="field-error" id="main_email-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="main_phone">Telefono *</label>
                  <input type="tel" id="main_phone" required aria-describedby="main_phone-error">
                  <p class="field-error" id="main_phone-error" aria-live="polite"></p>
                </div>
              </div>

              <h3 class="subsection-title">Contatti ACN</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="acn_contact_name">Nome *</label>
                  <input type="text" id="acn_contact_name" required aria-describedby="acn_contact_name-error">
                  <p class="field-error" id="acn_contact_name-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="acn_contact_surname">Cognome *</label>
                  <input type="text" id="acn_contact_surname" required aria-describedby="acn_contact_surname-error">
                  <p class="field-error" id="acn_contact_surname-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="acn_contact_email">Email *</label>
                  <input
                    type="email"
                    id="acn_contact_email"
                    required
                    inputmode="email"
                    pattern="^[\w.+-]+@[\w.-]+\.[A-Za-z]{2,}$"
                    aria-describedby="acn_contact_email-error"
                    data-error-message="Inserisci un indirizzo email valido (es. nome@dominio.it)."
                  >
                  <p class="field-error" id="acn_contact_email-error" aria-live="polite"></p>
                </div>
              </div>

              <h3 class="subsection-title">Vice Referenti (Opzionali)</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="sub_1_name">Nome Vice 1</label>
                  <input type="text" id="sub_1_name" aria-describedby="sub_1_name-error">
                  <p class="field-error" id="sub_1_name-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="sub_1_surname">Cognome Vice 1</label>
                  <input type="text" id="sub_1_surname" aria-describedby="sub_1_surname-error">
                  <p class="field-error" id="sub_1_surname-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="sub_1_email">Email Vice 1</label>
                  <input
                    type="email"
                    id="sub_1_email"
                    inputmode="email"
                    pattern="^$|^[\w.+-]+@[\w.-]+\.[A-Za-z]{2,}$"
                    aria-describedby="sub_1_email-error"
                    data-error-message="Inserisci un indirizzo email valido (es. nome@dominio.it)."
                  >
                  <p class="field-error" id="sub_1_email-error" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="sub_2_name">Nome Vice 2</label>
                  <input type="text" id="sub_2_name" aria-describedby="sub_2_name-error">
                  <p class="field-error" id="sub_2_name-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="sub_2_surname">Cognome Vice 2</label>
                  <input type="text" id="sub_2_surname" aria-describedby="sub_2_surname-error">
                  <p class="field-error" id="sub_2_surname-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="sub_2_email">Email Vice 2</label>
                  <input
                    type="email"
                    id="sub_2_email"
                    inputmode="email"
                    pattern="^$|^[\w.+-]+@[\w.-]+\.[A-Za-z]{2,}$"
                    aria-describedby="sub_2_email-error"
                    data-error-message="Inserisci un indirizzo email valido (es. nome@dominio.it)."
                  >
                  <p class="field-error" id="sub_2_email-error" aria-live="polite"></p>
                </div>
              </div>

              <div class="form-group">
                <label for="motivation_notes">Motivazione Designazione</label>
                <textarea id="motivation_notes" rows="3" aria-describedby="motivation_notes-error"></textarea>
                <p class="field-error" id="motivation_notes-error" aria-live="polite"></p>
              </div>

              <button type="submit" class="submit-btn">üíæ Salva Designazione</button>
            </form>
          </section>

          <section id="configurazione" class="section">
            <h2 class="section-title">üåê Configurazione Rete</h2>
            <div id="configurazione-message" class="message"></div>
            <form id="configurazione-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="cfg_company_id">Azienda *</label>
                  <select id="cfg_company_id" required aria-describedby="cfg_company_id-error">
                    <option value="">Caricamento...</option>
                  </select>
                  <p class="field-error" id="cfg_company_id-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="topology_type">Topologia *</label>
                  <select id="topology_type" required aria-describedby="topology_type-error">
                    <option value="">Seleziona...</option>
                    <option value="LAN">LAN</option>
                    <option value="WAN">WAN</option>
                    <option value="Cloud">Cloud</option>
                    <option value="Ibrida">Ibrida</option>
                  </select>
                  <p class="field-error" id="topology_type-error" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="sites_count">Numero Sedi</label>
                  <input type="number" id="sites_count" aria-describedby="sites_count-error">
                  <p class="field-error" id="sites_count-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="users_count">Numero Utenti</label>
                  <input type="number" id="users_count" aria-describedby="users_count-error">
                  <p class="field-error" id="users_count-error" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="firewall_type">Tipo Firewall</label>
                  <select id="firewall_type" aria-describedby="firewall_type-error">
                    <option value="">Seleziona...</option>
                    <option value="Hardware dedicato">Hardware dedicato</option>
                    <option value="Virtual Firewall">Virtual Firewall</option>
                    <option value="Cloud Firewall">Cloud Firewall</option>
                  </select>
                  <p class="field-error" id="firewall_type-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="firewall_model">Modello/Versione</label>
                  <input type="text" id="firewall_model" aria-describedby="firewall_model-error">
                  <p class="field-error" id="firewall_model-error" aria-live="polite"></p>
                </div>
              </div>
              <button type="submit" class="submit-btn">üíæ Salva Configurazione</button>
            </form>
          </section>

          <section id="incidenti" class="section">
            <h2 class="section-title">üö® Registra Incidente</h2>
            <div id="incidenti-message" class="message"></div>
            <form id="incidenti-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="inc_company_id">Azienda *</label>
                  <select id="inc_company_id" required aria-describedby="inc_company_id-error">
                    <option value="">Caricamento...</option>
                  </select>
                  <p class="field-error" id="inc_company_id-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="inc_title">Titolo Incidente *</label>
                  <input type="text" id="inc_title" required aria-describedby="inc_title-error">
                  <p class="field-error" id="inc_title-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="inc_datetime">Data e Ora Incidente *</label>
                  <input type="datetime-local" id="inc_datetime" required aria-describedby="inc_datetime-error">
                  <p class="field-error" id="inc_datetime-error" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="inc_severity">Gravit√† *</label>
                  <select id="inc_severity" required aria-describedby="inc_severity-error">
                    <option value="">Seleziona...</option>
                    <option value="critical">üî¥ Critica</option>
                    <option value="high">üü† Alta</option>
                    <option value="medium">üü° Media</option>
                    <option value="low">üü¢ Bassa</option>
                  </select>
                  <p class="field-error" id="inc_severity-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="inc_status">Stato *</label>
                  <select id="inc_status" required aria-describedby="inc_status-error">
                    <option value="">Seleziona...</option>
                    <option value="aperto">Aperto</option>
                    <option value="in-corso">In Corso</option>
                    <option value="risolto">Risolto</option>
                  </select>
                  <p class="field-error" id="inc_status-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="inc_type">Tipo Incidente *</label>
                  <select id="inc_type" required aria-describedby="inc_type-error">
                    <option value="">Seleziona...</option>
                    <option value="Malware">Malware</option>
                    <option value="Phishing">Phishing</option>
                    <option value="DDoS">DDoS</option>
                    <option value="Data Breach">Data Breach</option>
                    <option value="Ransomware">Ransomware</option>
                  </select>
                  <p class="field-error" id="inc_type-error" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-group">
                <label for="inc_description">Descrizione Incidente *</label>
                <textarea id="inc_description" required rows="4" aria-describedby="inc_description-error"></textarea>
                <p class="field-error" id="inc_description-error" aria-live="polite"></p>
              </div>
              <button type="submit" class="submit-btn">üíæ Salva Incidente</button>
            </form>
          </section>

          <section id="visualizza" class="section">
            <h2 class="section-title">üìä Visualizza Dati</h2>
            <div style="margin-bottom: 30px;">
              <button class="nav-btn" id="refresh-incidents">üîÑ Aggiorna Lista Incidenti</button>
            </div>
            <div id="incidents-container" class="incidents-grid">
              <div class="loading">Caricamento incidenti...</div>
            </div>
          </section>

          <section id="notifiche" class="section">
            <h2 class="section-title">üîî Gestione Notifiche ACN/Autorit√†</h2>
            <div id="notifiche-message" class="message"></div>
            <form id="notifiche-form">
              <div class="form-group">
                <label for="notif_incident_id">Seleziona Incidente da Notificare *</label>
                <select id="notif_incident_id" required aria-describedby="notif_incident_id-error">
                  <option value="">Caricamento incidenti...</option>
                </select>
                <p class="field-error" id="notif_incident_id-error" aria-live="polite"></p>
              </div>
              <h3 class="subsection-title">Dettagli Notifica</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="notif_status">Stato Notifica *</label>
                  <select id="notif_status" required aria-describedby="notif_status-error">
                    <option value="Aperta">Aperta</option>
                    <option value="Notificata ACN">Notificata ACN</option>
                    <option value="Chiusa">Chiusa</option>
                  </select>
                  <p class="field-error" id="notif_status-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="notif_notification_title">Titolo Incidente (Riferimento)</label>
                  <input type="text" id="notif_notification_title" disabled>
                </div>
                <div class="form-group">
                  <label for="notif_datetime">Data e Ora Incidente</label>
                  <input type="datetime-local" id="notif_datetime" disabled>
                </div>
              </div>
              <div class="form-group">
                <label for="notif_impact_notes">Descrizione Danno/Impatto (Note)</label>
                <textarea id="notif_impact_notes" rows="3"></textarea>
              </div>
              <h3 class="subsection-title">Follow-up e Correzioni</h3>
              <div class="form-group">
                <label for="notif_risk_damage_notes">Valutazione Rischio e Danno (Note)</label>
                <textarea id="notif_risk_damage_notes" rows="3"></textarea>
              </div>
              <div class="form-group">
                <label for="notif_corrective_actions_notes">Azioni Correttive Adottate (Note)</label>
                <textarea id="notif_corrective_actions_notes" rows="3"></textarea>
              </div>
              <button type="submit" class="submit-btn">üíæ Salva Notifica</button>
            </form>
            <h3 class="subsection-title" style="margin-top: 50px;">Notifiche Inviate</h3>
            <div id="notifications-list" class="incidents-grid">
              <div class="loading">Caricamento notifiche...</div>
            </div>
          </section>

          <section id="utenti" class="section">
            <h2 class="section-title">üë• Gestione Utenti</h2>
            <div id="utenti-message" class="message"></div>
            <form id="utenti-form">
              <h3 class="subsection-title">Crea Nuovo Utente</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="new_user_email">Email *</label>
                  <input
                    type="email"
                    id="new_user_email"
                    required
                    inputmode="email"
                    pattern="^[\w.+-]+@[\w.-]+\.[A-Za-z]{2,}$"
                    aria-describedby="new_user_email-error"
                    data-error-message="Inserisci un indirizzo email valido (es. nome@dominio.it)."
                  >
                  <p class="field-error" id="new_user_email-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="new_user_password">Password *</label>
                  <input type="password" id="new_user_password" required aria-describedby="new_user_password-error">
                  <p class="field-error" id="new_user_password-error" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="new_user_name">Nome Completo *</label>
                  <input type="text" id="new_user_name" required aria-describedby="new_user_name-error">
                  <p class="field-error" id="new_user_name-error" aria-live="polite"></p>
                </div>
                <div class="form-group">
                  <label for="new_user_role">Ruolo *</label>
                  <select id="new_user_role" required aria-describedby="new_user_role-error">
                    <option value="">Seleziona...</option>
                    <option value="admin">üëë Admin</option>
                    <option value="csirt">üõ°Ô∏è Referente CSIRT</option>
                    <option value="company">üè¢ Referente Aziendale</option>
                  </select>
                  <p class="field-error" id="new_user_role-error" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-group" id="user-company-field" style="display: none;">
                <label for="new_user_company">Azienda Associata</label>
                <select id="new_user_company" aria-describedby="new_user_company-error">
                  <option value="">Caricamento...</option>
                </select>
                <p class="field-error" id="new_user_company-error" aria-live="polite"></p>
              </div>
              <button type="submit" class="submit-btn">üë§ Crea Utente</button>
            </form>
            <h3 class="subsection-title" style="margin-top: 50px;">Lista Utenti</h3>
            <div id="users-list" class="loading">Caricamento utenti...</div>
          </section>
        </div>
      </div>
    </div>

    <script type="module" src="src/main.js"></script>
  </body>
</html>
